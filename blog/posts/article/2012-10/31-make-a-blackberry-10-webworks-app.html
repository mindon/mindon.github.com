
<am-article time="2012-10-31 14:52:00 +0800" tags="[Mobile-App Mindon]" slug="2012/10/31/make-a-blackberry-10-webworks-app">
    <h1 slot="title">Make a Blackberry 10 WebWorks Application</h1>
    <div slot="content"><css-style/><p>BlackBerry 10 from RIM ( Research In Motion ) is comming.</p>

<p><a href="https://developer.blackberry.com/">BlackBerry Developer</a>, we could see the bb10 provides a variety of options to develop an app:  C/C++ Native SDK, HTML5 WebWorks, Action Script with Adobe AIR, Java in Android Runtime, or with Blackberry Java.</p>

<p>What a platform! ( How&rsquo;s its performance? )</p>

<p>Here I will focus on the <a href="https://developer.blackberry.com/html5/">HTML5 WebWorks</a> app, what kind of problems you need to face. ( All base on windows env. )</p>

<h2>Prepareations</h2>

<p>Following SDK and tools you could find <a href="https://developer.blackberry.com/html5/download/">here</a>.</p>

<ul>
<li><strong>Ripple emulator</strong></li>
</ul>

<p>It&rsquo;s a Chrome Extension to help you previewing the webworks app UI.</p>

<ul>
<li><strong>WebWorks SDK</strong></li>
</ul>

<p>Remember to append the path <strong>%WebWorksSDK_HOME%\dependencies\tools\bin</strong> to the Env variable PATH.</p>

<p>Here the <strong>%WebWorksSDK_HOME%</strong> is the root folder you installed your WebWorks SDK. you could set it as an Env. Variable.</p>

<ul>
<li><strong>BlackBerry 10 Dev Alpha Simulator</strong></li>
</ul>

<p>You need VMWare Player to run the Simulator.</p>

<ul>
<li><strong>Native SDK</strong> (Optional: You will need this for an Native WebWorks Extension )</li>
</ul>

<p><a href="http://developer.blackberry.com/native/beta/download/">http://developer.blackberry.com/native/beta/download/</a></p>

<ul>
<li><strong>Android App Verify and Repackage tools</strong> (Optional: Try repackage some android app you like into bb10 )</li>
</ul>

<p><a href="http://developer.blackberry.com/android/tools/">http://developer.blackberry.com/android/tools/</a></p>

<!--more-->

<h2>Ripple Emulator</h2>

<ul>
<li><p>Remember to &ldquo;Start Ripple Services&rdquo; first</p></li>

<li><p>You need to serve your html5 webworks app folder as website - simplest as localhost. ( you make choose Nginx or some simple green web servers )</p></li>

<li><p>Visit <a href="http://localhost/">http://localhost/</a>, and &ldquo;Enable&rdquo; the Ripple Mission. ( It will crashes your Chome sometimes ).</p></li>
</ul>

<h2>WebWorks SDK</h2>

<ul>
<li><p>It contains a node.exe for the SDK: *<em>%WebWorksSDK_HOME%\dependencies\node*</em>, you could get the latest node.exe from <a href="http://nodejs.org/">http://nodejs.org/</a> :-)</p></li>

<li><p>The package tool bbwp is <strong>%WebWorksSDK_HOME%\bbwp.bat</strong>, which content is: &ldquo;%~dp0dependencies\node\node.exe&rdquo; &ldquo;%~dp0lib\bbwp.js&rdquo; %*</p></li>
</ul>

<p>full command will be like: <strong>%WebWorksSDK_HOME%\dependencies\node\node.exe %WebWorksSDK_HOME%\lib\bbwp.js mydemo-app.zip</strong></p>

<ul>
<li>WebWorks App use JNEXT to run the HTML5 as an app ( JNEXT: <a href="http://jnext.org">http://jnext.org</a> )</li>
</ul>

<h2>BlackBerry 10 Dev Alpha Simulator</h2>

<ul>
<li><p>At first, you will be drived crazy by its full size screen in VMWare Player.</p></li>

<li><p>A &ldquo;Controller&rdquo; tool installed with the simulator could help you manage the screen size in the vmware player:</p></li>
</ul>

<p>1) Find the menu &ldquo;Connection / connect&rdquo;, you need the IP left bottom of the bb10 simulator, some like &ldquo;192.168.111.128&rdquo;, NOT the 169.254.0.1 which is for device not the simulator.</p>

<p>2) After success connect, find the menu &ldquo;Device / Change Zoom Level&rdquo; &ndash; It could help you to resize the simulator screen to fit your host screen size.</p>

<ul>
<li><p>Other interest controll options could be found in the &ldquo;Controller&rdquo; tool. ( find it in your windows&rsquo; shortcut from ** Start / All Programs / BlackBerry 10 Simulator ** , or in the VM folder directly )</p></li>

<li><p>Want to install your app into the simulator? You need to turn on &ldquo;Development Mode&rdquo; in BB10 &ldquo;Settings / Security and Privacy / Development Mode&rdquo;</p></li>

<li><p>The IP setting in the &ldquo;Development Mode&rdquo; is for device only</p></li>

<li><p>Each time the device restart, you need to turn on the &ldquo;Development Mode&rdquo; again ( You won&rsquo;t face this problem in a simulator )</p></li>
</ul>

<h2>BB10 Device Software Update</h2>

<p>Before Updating the BlackBerry 10 Dev Alpha Device Software, you need to</p>

<ul>
<li><p>Install Blackberry <strong>Desktop Software</strong> first: <a href="http://blackberry.com/desktop">http://blackberry.com/desktop</a></p></li>

<li><p>Then use the <a href="https://developer.blackberry.com/blackberry10devalphas/update">App Loader</a> tool to update</p></li>

<li><p>Remember, be really patient during the update processing :-)</p></li>
</ul>

<h1>Start the WebWorks App Development</h1>

<p>You could find more sample and details from <a href="http://blackberry.github.com/webworks/index.html">blackberry&rsquo;s github project</a></p>

<h2>** config.xml **</h2>

<p>Chose those permisions and features your app needs:</p>

<p><strong>Permissions</strong></p>

<p><a href="rim:permissions">rim:permissions</a>
<a href="rim:permit">rim:permit</a>read_device_identifying_information<a href="/rim:permit">/rim:permit</a>
<a href="rim:permit">rim:permit</a>record_audio<a href="/rim:permit">/rim:permit</a>
<a href="rim:permit">rim:permit</a>access_location_services<a href="/rim:permit">/rim:permit</a>
<a href="rim:permit">rim:permit</a>bbm_connect<a href="/rim:permit">/rim:permit</a>
<a href="rim:permit">rim:permit</a>access_pimdomain_messages<a href="/rim:permit">/rim:permit</a>
<a href="rim:permit">rim:permit</a>access_pimdomain_contacts<a href="/rim:permit">/rim:permit</a>
<a href="rim:permit">rim:permit</a>access_pimdomain_calendars<a href="/rim:permit">/rim:permit</a>
<a href="rim:permit">rim:permit</a>access_pimdomain_notebooks<a href="/rim:permit">/rim:permit</a>
<a href="rim:permit">rim:permit</a>post_notifications<a href="/rim:permit">/rim:permit</a>
<a href="rim:permit">rim:permit</a>access_sms_mms<a href="/rim:permit">/rim:permit</a>
<a href="rim:permit">rim:permit</a>access_shared<a href="/rim:permit">/rim:permit</a>
<a href="rim:permit">rim:permit</a>access_internet<a href="/rim:permit">/rim:permit</a>
<a href="rim:permit">rim:permit</a>read_geolocation<a href="/rim:permit">/rim:permit</a>
<a href="rim:permit">rim:permit</a>use_camera<a href="/rim:permit">/rim:permit</a>
<a href="rim:permit">rim:permit</a>run_native<a href="/rim:permit">/rim:permit</a>
<a href="rim:permit">rim:permit</a>run_when_backgrounded<a href="/rim:permit">/rim:permit</a>
<a href="/rim:permissions">/rim:permissions</a></p>

<p>** Orientation **</p>

<p><rim:orientation mode="auto"/></p>

<p>** Splash **</p>

<p><rim:splash src="splash.jpg" /></p>

<p>** Features **</p>

<p><feature id="blackberry.app.orientation">
<param name="mode" value="portrait" />
</feature></p>

<p><feature id="blackberry.app">
<param name="backgroundColor" value="0xFFFFFF00" />
</feature></p>

<p><feature id="blackberry.app.event"/>
<feature id="blackberry.invoke"/>
<feature id="blackberry.app" />
<feature id="blackberry.ui.dialog" />
<feature id="blackberry.ui.Spinner" />
<feature id="blackberry.push" />
<feature id="blackberry.message.sms" />
<feature id="blackberry.ui.menu" />
<feature id="blackberry.identity" /></p>

<p>** Access **</p>

<p><access uri="*" subdomains="true" /></p>

<h2>** webworks.js **</h2>

<p>You need this js in your HTML5 code!</p>

<ul>
<li><p>Latest version of webworks.js could be found in *<em>%WebWorksSDK_HOME%\Framework\clientFiles*</em></p></li>

<li><p>DO REMEMBER copy and include it as your HTML5 webworks app resources before calling any Blackberry API from your javascript code.</p></li>
</ul>

<h2>** bbUI.js **</h2>

<p><a href="https://github.com/blackberry/bbui.js">https://github.com/blackberry/bbui.js</a></p>

<blockquote>
<p>The objective of the bbUI toolkit is to provide a BlackBerry® User Experience and Design Language for HTML5 applications using the BlackBerry WebWorks framework.</p>
</blockquote>

<ul>
<li><p>Try to use this for your demo. But sure you could use your own code to do these things.</p></li>

<li><p>bbUI.js is using <strong>iScroll</strong> for its scroller effect from <a href="http://cubiq.org/iscroll-4">http://cubiq.org/iscroll-4</a></p></li>
</ul>

<h2>Shell Script help to Package and Install your webwoks app to BB10 simulator</h2>

<p>Requirement NOTICE:</p>

<p>1) you need install <a href="http://www.7-zip.org/">7z</a> and append its 7z.exe path to Env. variable PATH.</p>

<p>2) set the WebWorksSDK_HOME env. variable for your webworks sdk installed real path.</p>

<p>3) change the -device 192.168.111.128 to your simulator IP</p>

<p>4) Update the device password, if you don&rsquo;t have one, remove the <strong>-password your-device-password</strong></p>

<p>Then save following code as <strong>bb-pack-install.cmd</strong>, then drag-drop your app folder on on it.</p>

<p>@call :reverse &ldquo;%*&rdquo;</p>

<p>FOR /F &ldquo;tokens=1 delims=\&rdquo; %%G IN (&ldquo;%reverse.result%&rdquo;) DO @set adir=%%G</p>

<p>@call :reverse &ldquo;%adir%&rdquo;</p>

<p>echo ## Package and Install ## &ndash; %reverse.result%
echo &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</p>

<p>@if exist simulator\%reverse.result%.bar (
del simulator\%reverse.result%.bar
)
@if exist device\%reverse.result%.bar (
del device\%reverse.result%.bar
)</p>

<p>@if not exist %~dp0%reverse.result%.zip (
cd %reverse.result%
7z.exe a -tzip %~dp0%reverse.result%.zip &ldquo;.*&rdquo; -r
cd %~dp0
)</p>

<p>@%WebWorksSDK_HOME%\dependencies\node\node.exe %WebWorksSDK_HOME%\lib\bbwp.js %~dp0%reverse.result%.zip</p>

<p>echo &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</p>

<p>@blackberry-deploy -installApp -password your-device-password -device 192.168.111.128 -package simulator\%reverse.result%.bar</p>

<dl>
<dt>pause</dt>
</dl>

<p>:reverse
@echo off
set reverse.tmp=%~1
set reverse.result=
:reverse.loop
set reverse.result=%reverse.tmp:~0,1%%reverse.Result%
set reverse.tmp=%reverse.tmp:~1,999%
if not &ldquo;%reverse.tmp%&rdquo;==&ldquo;&rdquo; goto:reverse.loop
goto:eof
eof:</p>

<h1>Signed your App for device</h1>

<h2>Apply Signed Keys</h2>

<p><a href="https://www.blackberry.com/SignedKeys/codesigning.html">https://www.blackberry.com/SignedKeys/codesigning.html</a></p>

<p>Apply and get two key files: <strong>client-PBDT-#######.csj</strong>, <strong>client-RDK-#######.csj</strong></p>

<p>DO REMEMBER the password you use to apply the key files ( as <strong>-csjpin</strong> value later )</p>

<h2>Signer Tool</h2>

<p>After you got the two files, download them and run following commend to sign the key files</p>

<p>blackberry-signer -proxyhost 123.45.67.89 -proxyport 8080 -register -csjpin csj-apply-password -cskpass my-store-password client-RDK-#######.csj client-PBDT-#######.csj</p>

<p>If you don&rsquo;t need proxy, remove the relative parameters. DO REMEMBER the proxy arguments <strong>MUST BE THE FIRST PARAMETER</strong> for <strong>blackberry-signer</strong>, if you put the somewhere else, it won&rsquo;t work.</p>

<p>The <strong>-cskpass</strong> you choose here will be the <strong>-storepass</strong> value for generate the <strong>debug token</strong>.</p>

<p>You could backup the 3 result files for other machine</p>

<p><strong>author.p12</strong>, <strong>barsigner.csk</strong> and <strong>barsigner.db</strong></p>

<ul>
<li><p><strong>Windows XP</strong>: %HOMEPATH%\Local Settings\Application Data\Research In Motion</p></li>

<li><p><strong>Windows Vista and Windows 7</strong>: %HOMEPATH%\AppData\Local\Research In Motion</p></li>

<li><p><strong>Mac OS</strong>: ~/Library/Research In Motion/</p></li>

<li><p><strong>UNIX or Linux</strong>: ~/.rim/</p></li>
</ul>

<p>By default, %HOMEPATH% is C:\Documents and Settings on Windows XP and C:\Users on Windows Vista and Windows 7.</p>

<p><a href="https://developer.blackberry.com/html5/documentation/signing_setup_tablet_apps_1920009_11.html">More detail on this topic</a></p>

<p>BTW: <strong>batchbar-signer</strong> for repackage android app DOES NOT support <strong>-proxyhost</strong> parameter when I write this blog. ( got this info by decompile the java class file used by this tool )</p>

<h2>Debug Token</h2>

<p>You need a debug token, the name of the debug token bar file could be chosen as you will.</p>

<p>blackberry-debugtokenrequest -proxyhost 123.45.67.89 -proxyport 8080 -storepass my-store-password -devicepin MY-DEVICE-PIN mindon_token.bar</p>

<p>DO REMEMBER the proxy arguments <strong>MUST BE THE FIRST PARAMETER</strong></p>

<p>Install the token bar file into your simulater (IP 192.168.111.###) or device (IP 169.254.0.1).</p>

<p>blackberry-deploy -installApp -password my-device-password -device 192.168.111.128 -package %*</p>

<h2>Package and Signed your App</h2>

<p>@%WebWorksSDK_HOME%\dependencies\node\node.exe %WebWorksSDK_HOME%\lib\bbwp.js -g my-store-password mydemo-app.zip</p>

<p>If you need to debug, add <strong>-d</strong> parameter before -g.</p>

<h2>How to signed an repackage of android app?</h2>

<p>batchbar-signer myandroid-app.bar author.p12 my-store-password -t product</p>

<p>The myandroid-app.bar is generated by command tool: <strong>apk2bar</strong> (It&rsquo;s not included in webworks sdk, and could fetch from <a href="http://developer.blackberry.com/android/tools/">http://developer.blackberry.com/android/tools/</a> )</p>

<h2>Another Issue when working an WebWorks Native Extension</h2>

<p>If you got an error &ldquo;Require Error Can&rsquo;t find /usr/lib/webplatform/plugins/jnext/***.so Libary cannot be found&rdquo;.</p>

<p>Try telnet 192.168.111.128 with devuser/devuser as account and password, you could never find your .so file there in the path even it works.</p>

<p>The error may comes from some other error - dependency missing or something else, who knows?</p>

<p>Most problems you met during the development, few you could get the right and directly answer in the development documents from BB website or forum. Google helps sometimes, but not the right solution. Most casese, maybe you need to try or find the right develop guy in RIM.</p>

<p>Wish this could be helpful.</p>

<p>God bless you, dear BB10 developers :-)</p>

<p><i id="link-tags">blackberry 10;webworks</i></p>
</div>
     <a slot="next" class="next" href="/blog/2012/11/20/first-qml-blackberry-10-app">Trying Cascades+QML App for Blackberry 10</a>
     <a slot="prev" class="prev" href="/blog/2012/10/20/walking-to-work">走路上班的逆向足迹</a>
</am-article>
