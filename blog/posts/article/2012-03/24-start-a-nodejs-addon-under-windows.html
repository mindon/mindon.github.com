
<am-article time="2012-03-24 12:15:00 +0800" tags="[Web-Tech]" slug="2012/03/24/start-a-nodejs-addon-under-windows">
    <h1 slot="title">Start a NodeJS addon under windows</h1>
    <div slot="content"><h2>Code &amp; tools preparation</h2>

<p><strong>NodeJS source code</strong>
<a href="https://github.com/joyent/node">https://github.com/joyent/node</a></p>

<p><strong>VISUAL C++ 2010 EXPRESS</strong>
Free tools to create applications on Windows using Visual C++.
(Needs SP3 under winxp)</p>

<p><a href="http://www.microsoft.com/visualstudio/en-us/products/2010-editions/visual-cpp-express">Download VC++ 2010 EXPRESS</a></p>

<p><strong>Python 2.6 or 2.7</strong>
<a href="http://www.python.org/download/">http://www.python.org/download/</a></p>

<h2>Compile your NodeJS</h2>

<p>Run vcbuild.bat under NodeJS source folder.</p>

<h2>Compile the Hello-world</h2>

<p><strong>General Steps also fit for other addons</strong>
<!--more--></p>

<p>Get into folder test\addons\hello-world\ of NodeJS source</p>

<p>1, <strong>Edit binding.cc</strong></p>

<p>Add <strong>NODE_MODULE_EXPORT</strong> before <strong>void init</strong>
or Add <strong>NODE_EXTERN</strong> between <strong>void</strong> and <strong>init</strong></p>

<p>This could help avoid running &ldquo;Unkown error&rdquo; when require the addon in nodejs.</p>

<p>2, <strong>Generate project files</strong></p>

<p>set NODE_ROOT=your-node-js-src-root
python %NODE_ROOT%\tools\gyp_addon binding.gyp</p>

<p>3, <strong>Setup VC ENV variables</strong></p>

<p>Run</p>

<p>&ldquo;D:\Microsoft Visual Studio 10.0\VC\vcvarsall.bat&rdquo;</p>

<p>4, <strong>Build</strong></p>

<p>@set Configuration=Release</p>

<p>5, <strong>Test</strong></p>

<p>node
require(&lsquo;./build/Release/binding&rsquo;)</p>

<h2>Compile node-expat</h2>

<ol>
<li><p>Install Expat under windows
<a href="http://sourceforge.net/projects/expat/files/latest/download">http://sourceforge.net/projects/expat/files/latest/download</a></p></li>

<li><p>Prepare GYP build file</p></li>
</ol>

<p>{
&lsquo;targets&rsquo;: [
{
&lsquo;target_name&rsquo;: &lsquo;node-expat&rsquo;,
&lsquo;sources&rsquo;: [ &lsquo;node-expat.cc&rsquo; ],
&lsquo;include_dirs&rsquo;: [ &lsquo;expat-install-folder/Source/lib&rsquo; ],
&lsquo;libraries&rsquo;: [ &lsquo;-lexpat-install-folder/Bin/libexpat.lib&rsquo;  ],
}
]
}</p>

<p>A more detail guide could be found in another post: [Build Node-Expat Under Windows]()</p>

<h2>Compile node-xmpp</h2>

<ol>
<li><p>ICU unicode
<a href="http://site.icu-project.org/download/48">http://site.icu-project.org/download/48</a></p></li>

<li><p>node-stringprep windows version
<a href="https://github.com/andreasbotsikas/node-stringprep/tree/windows-build">https://github.com/andreasbotsikas/node-stringprep/tree/windows-build</a></p></li>

<li><p>node-xmpp</p></li>
</ol>

<p><a href="https://github.com/astro/node-xmpp">https://github.com/astro/node-xmpp</a></p>

<p><a href="http://www.adarshr.com/papers/xmpp">http://www.adarshr.com/papers/xmpp</a></p>

<h2>Reference</h2>

<ul>
<li><p><strong>Addons NodeJS document</strong>
<a href="http://nodejs.org/docs/latest/api/addons.html">http://nodejs.org/docs/latest/api/addons.html</a></p></li>

<li><p><strong>Windows上编译NodeJS native extension</strong>
<a href="http://cnodejs.org/topic/4f1fa3ed817ae4105c040fb4">http://cnodejs.org/topic/4f1fa3ed817ae4105c040fb4</a></p></li>

<li><p><strong>Building a Node.js Windows C/C++ Addon</strong>
<a href="http://coderesearchlabs.com/articles/BNWCA.pdf">http://coderesearchlabs.com/articles/BNWCA.pdf</a></p></li>
</ul>
</div>
    <a slot="next" href="/blog/2012/03/24/upgrade-winxp-from-sp2-to-sp3" title="Upgrade winxp from sp2 to sp3">Newer</a>
    <a slot="prev" href="/blog/2012/03/24/how-to-write-a-mail-in-html" title="How to write a mail in HTML">Older</a>
</am-article>
