
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Match Encrypt &amp; Decrypt in PHP and NodeJS - Mindon.IDEA</title>
  <meta name="author" content="Mindon Feng">

  
  <meta name="description" content="String encoded in PHP needs to decode in NodeJS? Or encoded in NodeJS needs to decode in PHP? Here&rsquo;s a match result with aes-128-cbc &amp; &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mindon.github.io/blog/2012/03/31/match-encrypt-and-decrypt-in-php-and-nodejs">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Mindon.IDEA" type="application/atom+xml">
  
</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Mindon.IDEA</a></h1>
  
    <h2>Air off, Mind on ~ / Javascript+Golang, Sci, Health&#8230; /</h2>
  
</hgroup>
<div id="google_translate_element" style="position:absolute;top:96px;right:16px;z-index:999999;opacity:0.3;+filter:Alpha(Opacity=30)"></div>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://www.google.com" method="get" id="cse-search-box">
  <fieldset role="search">
    <input class="search" type="text" name="q" results="0" />
    <input type="hidden" name="cx" value="partner-pub-6997921015773263:7607104621" />
    <input type="hidden" name="ie" value="UTF-8" />
  </fieldset>
</form>
<script type="text/javascript">
(function() {
  var job = document.createElement('script'); job.type = 'text/javascript'; job.async = true;
  job.src = 'http://www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en';
  var ss = document.getElementsByTagName('script'), s=ss[ss.length-1]; s.parentNode.insertBefore(job, s); s=null;
})();
</script>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a><sup><a href="/blog/archives">* Archives</a></sup></li>
  <li><a href="/blog/categories/chrome-app" title="Chrome Apps & Toolkits">Devel</a></li>
  <li><a href="/note">Note</a><sup><a href="/trouble">* Trouble/S</a></sup></li>
  <li><a href="/blog/categories/chinese-balance-heal"><img src="/images/coc.png" width="27" height="27" alt="C3" title="Chinese Balance Health Theory" border="0" align="absmiddle" /></a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Match Encrypt &amp; Decrypt in PHP and NodeJS</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2012-03-31T00:20:00+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>31</span><span class='date-suffix'>st</span>, <span class='date-year'>2012</span></span> <span class='time'>12:20 am</span></time>
        
      </p>
    
  </header>



<div class="entry-content">

	<div class="adpost">
		<script type="text/javascript"><!--
		google_ad_client = "ca-pub-6997921015773263";
		/* git-post */
		google_ad_slot = "5984167509";
		google_ad_width = 300;
		google_ad_height = 250;
		//-->
		</script>
		<script type="text/javascript"
		src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
		</script>
	</div>
<A NAME="A,BODY"></A>
<p>String encoded in PHP needs to decode in NodeJS?</p>

<p>Or encoded in NodeJS needs to decode in PHP?</p>

<p>Here&rsquo;s a match result with aes-128-cbc &amp; their demo code, you could choose your 16 characters key &amp; a different iv(initial vector):</p>

<p>NodeJS</p>

<pre><code>var crypto = require('crypto')
  , key = 'abcdefghijklmnop'
  , iv = '0123456789123456'
  , cipher = crypto.createCipheriv('aes-128-cbc', key, iv);

var text = 'Clipher Message'
  , crypted = cipher.update(text, 'utf-8', 'hex');

crypted += cipher.final('hex');

// encrypted
console.log(crypted);


var decipher = crypto.createDecipheriv('aes-128-cbc', key, iv)
  , decrypted = decipher.update(crypted, 'hex', 'utf-8');

decrypted += decipher.final('utf-8');

// decrypted
console.log(decrypted);
</code></pre>

<!--more-->


<p>PHP</p>

<pre><code>&lt;?php
function hex2bin($hex_string) {
    return pack('H*', $hex_string);
}
$text = 'Clipher Message';
$key = 'abcdefghijklmnop';
$iv = '0123456789123456';

function iEncrypt($data, $key, $iv) {
    $blocksize = 16;
    $pad = $blocksize - (strlen($data) % $blocksize);
    $data = $data . str_repeat(chr($pad), $pad);
    return bin2hex(mcrypt_encrypt(MCRYPT_RIJNDAEL_128, $key, $data, MCRYPT_MODE_CBC, $iv));
}

function iDecrypt($data, $key, $iv) {
    return mcrypt_decrypt(MCRYPT_RIJNDAEL_128, $key, hex2bin($data), MCRYPT_MODE_CBC, $iv);
}

$encrypted = iEncrypt($text, $key, $iv);
echo $encrypted.'&lt;br/&gt;';
echo iDecrypt($encrypted, $key, $iv);
?&gt;
</code></pre>

<p><a href="http://stackoverflow.com/questions/3716691/relation-between-input-and-ciphertext-length-in-aes">Relation between input and ciphertext length in AES</a></p>

<blockquote><p>Some encryption algorithms are stream ciphers which encrypt data &ldquo;bit by bit&rdquo; (or &ldquo;byte by byte&rdquo;). Most of them produce a key-dependent stream of pseudo-random bytes, and encryption is performed by XORing that stream with the data (decryption is identical). With a stream cipher, the encrypted length is equal to the plain data length.</p>

<p>Other encryption algorithms are block ciphers. A block cipher, nominally, encrypts a single block of data of a fixed length. AES is a block cipher with 128-bit blocks (16 bytes). Note that AES-256 also uses 128-bit blocks; the &ldquo;256&rdquo; is about the key length, not the block length. The chaining mode is about how the data is to be split into several such blocks (this is not easy to do it securely, but CBC mode is fine). Depending on the chaining mode, the data may require some padding, i.e. a few extra bytes added at the end so that the length is appropriate for the chaining mode. The padding must be such that it can be unambiguously removed when decrypting.</p>

<p>With CBC mode, the input data must have a length multiple of the block length, so it is customary to add PKCS#5 padding: if the block length is n, then at least 1 byte is added, at most n, such that the total size is a multiple of n, and the last added bytes (possibly all of them) have numerical value k where k is the number of added bytes. Upon decryption, it suffices to look at the last decrypted byte to recover k and thus know how many padding bytes must be ultimately removed.</p>

<p>Hence, with CBC mode and AES, assuming PKCS#5 padding, if the input data has length d then the encrypted length is (d + 16) &amp; ~15. I am using C-like notation here; in plain words, the length is between d+1 and d+16, and multiple of 16.</p>

<p>There is a mode called CTR (as &ldquo;counter&rdquo;) in which the block cipher encrypts successive values of a counter, yielding a stream of pseudo-random bytes. This effectively turns the block cipher into a stream cipher, and thus a message of length d is encrypted into d bytes.</p>

<p>Warning: about all encryption systems (including stream ciphers) and modes require an extra value called the IV (Initial Value). Each message shall have its IV, and no two messages encrypted with the same key shall use the same IV. Some modes have extra requirements; in particular, for both CBC and CTR, the IV shall be selected randomly and uniformly with a cryptographically strong pseudo-random number generator. The IV is not secret, but must be known by the decrypter. Since each message gets its own IV, it is often needed to encode the IV along with the encrypted message. With CBC or CTR, the IV has length n, so, for AES, that&rsquo;s an extra 16 bytes. I do not know what mcrypt does with the IV, but, cryptographically speaking, the IV must be managed at some point.</p></blockquote>

<p>An article on AES cliper (in Chinese) <a href="http://blog.csdn.net/searchsun/article/details/2516191">http://blog.csdn.net/searchsun/article/details/2516191</a></p>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Mindon Feng</span></span>

      




<time class='entry-date' datetime='2012-03-31T00:20:00+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>31</span><span class='date-suffix'>st</span>, <span class='date-year'>2012</span></span> <span class='time'>12:20 am</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/web-tech/'>web-tech</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/03/26/amazing-webgl-and-html5-apps/" title="Previous Post: Amazing WebGL and HTML5 Apps">&laquo; Amazing WebGL and HTML5 Apps</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/04/15/there-are-other-choices/" title="Next Post: There are other choices">There are other choices &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>


</div>

<aside class="sidebar">
  
    <section>
    <h1>About Me</h1>
    <img src="/images/mindon.png" width="128" height="128" alt="Mindon" />
    <p>麥盾, <a title="mindon/!at/gmail/!dot/com" href="/about/">Mindon</a> | <a id="mydonate" name="donate" href="#donate" title="Inspire Me! Thanks"><b>Donate!</b></a>
    <br />Web Developer, @10c</p>
</section>
<form id="fmdonate" action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank" style="display:none">
<input type="hidden" name="cmd" value="_s-xclick">
<input type="hidden" name="hosted_button_id" value="HCJSW6U8PUNEJ">
</form>
<script>
function idonate(key) {
  var fm = document.getElementById('fmdonate');
  fm['hosted_button_id'].value = key;
  fm.submit();
}
document.getElementById('mydonate').onclick = function(){
  idonate('YSVEJMBLM3AFG');
};
</script>

<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/108546803797935855689?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>


<section>
  <h1>Categories</h1>
  <ul>

    <li>&raquo; <a class='category' href="/blog/categories/blogms/">blogms</a> ( 308 )</li>

    <li>&raquo; <a class='category' href="/blog/categories/mindon/">mindon</a> ( 98 )</li>

    <li>&raquo; <a class='category' href="/blog/categories/web-tech/">web-tech</a> ( 34 )</li>

    <li>&raquo; <a class='category' href="/blog/categories/light-air-water-m-sci/">light-air-water-m-sci</a> ( 14 )</li>

    <li>&raquo; <a class='category' href="/blog/categories/readings/">readings</a> ( 17 )</li>

    <li>&raquo; <a class='category' href="/blog/categories/chinese-balance-heal/">chinese-balance-heal</a> ( 8 )</li>

    <li>&raquo; <a class='category' href="/blog/categories/chrome-app/">chrome-app</a> ( 12 )</li>

    <li>&raquo; <a class='category' href="/blog/categories/mobile-app/">mobile-app</a> ( 16 )</li>

  </ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/05/26/the-lean-startup/">The Lean Startup</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/26/my-first-flight-with-dji-phantom-3-professional/">My First Flight With DJI Phantom 3 Professional</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/06/my-first-drone-a-dji-phantom-3-professional/">My First Drone: A DJI Phantom 3 Professional</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/18/embarrassed-2014/">尴尬的2014</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/18/what-makes-everything-connected/">连接一切？是什么让连接建立起来了？</a>
      </li>
    
  </ul>
</section>



<section>
    <h1>Google廣告</h1>
	<script type="text/javascript"><!--
	google_ad_client = "ca-pub-6997921015773263";
	/* git-aside */
	google_ad_slot = "4887341949";
	google_ad_width = 250;
	google_ad_height = 250;
	//-->
	</script>
	<script type="text/javascript"
	src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
	</script>
</section><section>
    <h1>Links</h1>
	<ul>
		<li><a href="http://www.ted.com/" target="_blank">TED: Ideas worth spreading</a></li>
		<li><a href="http://www.sciencemag.org/" target="_blank">Science Magazine</a></li>
		<li><a href="http://www.spongelab.com/browse/" target="_blank" title="Search science topics, lesson plans, case studies and more">SpongeLab</a></li>
		<li><a href="http://catlinseaviewsurvey.com/seaview.htm" target="_blank">Sea View Survey</a></li>
		<li><a href="http://www.me.gatech.edu/hu/" target="_blank">Hoogle</a></li>
		<li><b>傳統中醫 TCM</b>
    <ul>
      <li><a href="http://jicheng.tw/jcw/" target="_blank">笈成資料庫</a></li>
      <li><a href="http://www.cmchk.org.hk/pcm/chi/" target="_blank">香港中醫藥管理委員會</a></li>
      <li><a href="http://tcm.cmu.edu.tw/zh-tw/" target="_blank">中醫藥資料庫@Taiwan</a></li>
      <li><a href="http://www.relativehumanity.com.tw/web/chinesemedicine.htm" target="_blank">中醫世界</a> | <a href="http://www.relativehumanity.com.tw/web/main01.htm" target="_blank">身與心的平衡</a></li>
    </ul>
    </li>
		<li><b>Readings Around</b>
    <ul>
      <li><a href="http://yeeyan.org/" target="_blank">译言网</a></li>
    </ul>
    </li>
		<li><b>Development</b>
    <ul>
      <li><a href="http://commondatastorage.googleapis.com/chromium-browser-continuous/index.html" target="_blank">Chrome Latest Build</a></li>
      <li><a href="http://snapsvg.io/" target="_blank">SnapSVG</a></li>
      <li><a href="http://www.cocos2d-iphone.org/" target="_blank">COCOS2D</a></li>
    </ul>
    </li>
		<li><b>Friends</b>
    <ul>
      <li><a href="http://askcuix.github.io" target="_blank">Chris&#8217;s Blog</a></li>
      <li><a href="http://justinyan.me" target="_blank">枫言枫语</a></li>
    </ul>
    </li>
		<li><a href="http://blog.sina.com.cn/aby" target="_blank">Aby.生活</a> | <a href="http://weibo.com/imaby" target="_blank">微博</a></li>
		<li><a href="http://mindon.appspot.com/" target="_blank">Mindon.IDEA</a> @GAE  | <a href="http://weibo.com/mindon" target="_blank">微博</a></li>
		<li>PHOTO @<a href="https://picasaweb.google.com/mindon" target="_blank">Picasa</a> | @<a href="http://www.flickr.com/photos/mindon/" target="_blank">Flickr</a> | @<a href="http://photos.nphoto.net/mindon/" target="_blank">NPhoto</a></li>
		<li>@<a href="http://pinterest.com/mindon/" target="_blank">Pinterest</a> | <a href="http://db.tt/eYIbyv7" target="_blank">DropxBox</a></li>
		<li><a href="http://www.hk-rfid.com/" target="_blank" title="Hong Kong RFID Limited is the leading RFID hardware manufacturer, distributor and consultancy firm in Hong Kong and the South China Region."><img src="/images/HKRFID-logo.png" border="0" alt="Hong Kong RFID" /></a></li>
	</ul>
</section>
<section>
    <h1>Learn More</h1>
	<ul>
		<li><a href="http://www.20thingsilearned.com/zh-CN" target="_blank" title="About Browsers & The Web: 关于浏览器和网络的 20 个知识点">Things I Learned</a></li>
		<li><a href="http://www.google.com/intl/zh-CN/goodtoknow/" target="_blank" title="安全健康上网">Good To Know</a></li>
		<li><a href="http://open.163.com/ted" target="_blank">网易公开课 - TED演讲</a></li>
	</ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Mindon Feng -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>
<script src="/javascripts/modernizr-2.6.2.js"></script>
<script src="/javascripts/libs/jquery.min.js"></script>
<script src="/javascripts/octopress.js"></script>

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-28048168-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<script>
;!function(e,t,r){var n='getElementsByTagName',f=e[n](t)[0]||e[n]('script')[0],x=e.styleSheets;for(var s,c;(s=r.shift())&&(c=e.createElement(t));){c.rel='stylesheet';c.href=s.length==2?s[0]:s;c.media='only x';f.parentNode.insertBefore(c,f);m(c,s,0)}function m(c,s){var d,i;for(i=0;i<x.length;i++){if(x[i].href&&x[i].href.indexOf(s[0])>-1){d=1}if(d){c.media=s.length==2?s[1]:'all'}else{setTimeout(function(){m(c,s)},50)}}}}(document,'link',[
  'http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic'
 ,'http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic'
]);
function js(src){
var job = document.createElement('script'); job.type = 'text/javascript'; job.async = true;
  job.src = src; var ss = document.getElementsByTagName('script'), s=ss[ss.length-1]; s.parentNode.insertBefore(job, s); ss=s=null;
}
$(document).ready(function(){if($('#more-tips').length) $('#more-tips').remove(); if($('#link-tags').length) js('/javascripts/mindon-tags.js')})</script>

<script>
function googleTranslateElementInit() {
  new google.translate.TranslateElement({
    pageLanguage: 'en',
    autoDisplay: false,
    multilanguagePage: true,
    gaTrack: true,
    gaId: 'UA-28048168-2',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
  }, 'google_translate_element');
}
// skip IE translate
!document.attachEvent && (function() {
  js('http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit');
})();
</script>



</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'mindon';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://mindon.github.io/blog/2012/03/31/match-encrypt-and-decrypt-in-php-and-nodejs/';
        var disqus_url = 'http://mindon.github.io/blog/2012/03/31/match-encrypt-and-decrypt-in-php-and-nodejs/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>







</body>
</html>
