<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no">
  <title>中国科技大学60周年庆 :: USTC - 60TH ANNIVERSARY</title>
  <meta name="keywords" content="USTC, 60TH ANNIVERSARY">
  <meta name="description" content="中国科技大学60周年庆 USTC 60TH ANNIVERSARY">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-28048168-2"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
if(location.hostname != 'localhost') {
gtag('js', new Date());
gtag('config', 'UA-28048168-2');
</script>
  <script src="assets/touch-emulator.min.js"></script>
  <script>var _CLICK = ('ontouchstart' in window)?'tap':'click',touchEmulatorOff=false; if(!('ontouchstart' in window)){TouchEmulator();}</script>  
</head>
<body>
<style>
html, body{
  height: 100%; width: 100%;
  margin: 0; padding: 0;
  overflow: hidden;
  background-color: black;
  font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
}
.LANG_en en, .LANG_zh-CN zh-cn, .LANG_zh-TW zh-tw {
	display: inline;
}
.LANG_en zh-cn, .LANG_en zh-tw,
.LANG_zh-CN en, .LANG_zh-CN zh-tw,
.LANG_zh-TW en, .LANG_zh-TW zh-cn {
	display: none;
}
* {
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    -ms-box-sizing: border-box;
    box-sizing: border-box;
}

#mystage {
  width: 100%;
  height: 100%;
  max-width: 640px;
  margin: 0 auto;
  overflow: hidden;
  position: relative;
}
.gpu {
  -webkit-backface-visibility: hidden;
  -moz-backface-visibility: hidden;
  -ms-backface-visibility: hidden;
  backface-visibility: hidden;

  -webkit-perspective: 1000;
  -moz-perspective: 1000;
  -ms-perspective: 1000;
  perspective: 1000;

  -webkit-transform: translate3d(0, 0, 0);
  -moz-transform: translate3d(0, 0, 0);
  -ms-transform: translate3d(0, 0, 0);
  transform: translate3d(0, 0, 0);
}
#myarea {
  position: absolute;
  left: 0;
  top: 0;
  background-repeat: no-repeat;
  background-position: center center;
  background-size: contain;
}
#mymask {
  position: absolute;
  left: 0; top: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  background-repeat: no-repeat;
  background-position: center center;
  background-size: cover;
}

#myshare, #mydownload, #mysave, #mystyle, #myselect {
  position: relative;
  display: inline-block;
  margin-left: 5px;
}
#taskbar {
  position: absolute;
  left: 2%;
  width: 96%;
  bottom: 6px;
  max-height: 93px;
  z-index: 9999990;
  text-align: right;
  vertical-align: bottom;
}
#taskbar.create {
  bottom: 6px;
  height: 93px;
  max-height: 93px;
}

#mycreate {
  position: absolute;
  bottom: 0;
  right: 0;
}
#mycreate .icon {
  width: auto;
  overflow: hidden;
}
#mycreate div.icons {
  float: left;
}
#mycreate div.guide {
  float: left;
  height: 100%;
  line-height: 48px;
  padding-left: 1em;
  color: #fff;
}

#mytips {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
  z-index: 9999999;
  display: none;
  background: rgba(0,0,0,.8) none no-repeat right top;
}
#mytips .wx, .wechat #mytips .web {
  display: none;
}
.wechat #mytips .wx {
  display: block;
}
#mytips .web input {
  width: 75%;
  max-width: 420px;
  padding: 0 auto;
  height: 2em;
  line-height: 1.8em;
}
#mytips .web button {
  padding: 0 auto;
  height: 2em;
  border: 1px solid #999;
  border-left: none;
  background-color: #e6e6e6;
}
#mytips > div {
  position: absolute;
  top: 120px;
  background: #efefef;
  border-radius: 8px;
  width: 80%;
  right: 10%;
  padding: 4em 0;
  text-align: center;
}
.share-way {
  display: inline-block;
  line-height: 1em;
  padding: 0 6px;
  background: #888;
  color: #fff;
  border-radius: 2px;
}

#upform {
  position: absolute;
  z-index: 9999991;
  left: 0; top: 0;
  width: 1px; height: 1px;
  overflow:hidden;
  opacity: 0.01;
}
#upform.ios {
  opacity: 1;
  left: -1px !important;
  top: -1px !important;
  width: 1px !important;
  height: 1px !important;
}
#mypick {
  width: 100%;
  height: 100%;
}

.icons {
  width: 48px;
  height: 48px;
  background-repeat: no-repeat;
  /* background-image: url(assets/icons.png); */
  background-size: 100% auto;
}
.icon {
  padding: 2px;
  background-color: rgba(0,0,0,0.5);
  border: 2px solid #ccc;
  border-radius: 4px;
  cursor: pointer;
}

#mymusic {
  float: left;
}
#mymusic .icons {
  background-position: 0 -48px;
}
#mymusic.silence {
  background-color: rgba(64,64,64,0.5);
}
#mymusic.silence .icons {
  background-position: 0 -96px;
}
#stylist {
  background-color: rgba(0,0,0,0.9);
  width: 100%;
  position: absolute;
  bottom: 0;
  z-index: 9999998;
  vertical-align: middle;
  text-align: center;
  display: none;
  overflow: hidden;
}
#thumblist {
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  white-space: nowrap;
}
#listct img {
  width: 21%;
  max-width: 60px;
  max-height: 60px;
  margin: 0 0.5%;
  position: relative;
  top: 50%;
  -webkit-transform: translateY(-50%);
  -moz-transform: translateY(-50%);
  -ms-transform: translateY(-50%);
  transform: translateY(-50%);
}
#listct img.active {
  opacity: 0.4;
  cursor: default;
}
#listprev, #listnext {
  position: absolute;
  top: 0;
  width: 32px;
  height: 90px;
  line-height: 90px;
  color: #fff;
  background-repeat: no-repeat;
  background-position: center center;
  cursor: pointer;
}
#listprev {
  left: 4px;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAgBAMAAADtUjXCAAAAKlBMVEUAAAD////////////////c3NzMzMzLy8vPz8/////MzMz////Kysr///9zncolAAAADXRSTlMAPPOgAgbhsiC5oHgrbMdPZwAAADhJREFUGNNjgALGqTCW0G2YkK4JTOiyAz4h1jUwofAMmFBZAxWEECyELPUF18B9hOxxfIK3EaEGAH/XKRkvW9rRAAAAAElFTkSuQmCC');
}
#listnext {
  right: 4px;
	background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAgBAMAAADtUjXCAAAAKlBMVEUAAAD////////////////c3NzMzMzLy8vPz8/////MzMz////Kysr///9zncolAAAADXRSTlMAPPOgAgbhsiC5oHgrbMdPZwAAADdJREFUGNNjiBRggIK9ijCW8yWYIIstPsFTATDBtlKYIEc6VQURLIQs5UII16N7E58QIoQQoQYAXf4p65uPu+MAAAAASUVORK5CYII=');
}
#listprev:active, #listnext:active{
  opacity: 0.5;
}
#listprev.none, #listnext.none {
  opacity: 0.3;
}
#listct {
  width: 100%;
  height: 100%;
  padding: 0 10%;
} 

#mycreate, .create #myshare, .create #myselect {
  display: none;
}
.create #mycreate {
  display: none;
}
#mystyle .icons {
  background-position: 0 0;
}
#myselect .icons {
  background-position: 0 -192px;
}
#myshare .icons {
  background-position: 0 -240px;
}
#mydownload {
  display: none !important;
}
#mydownload .icons, #mysave .icons {
  background-position: 0 -288px;
}

#mytoast {
  border-radius: 8px;
  background-color:rgba(0,0,0,0.8);
  color: #fff;
  font-size: 12px;
  height: 3em;
  line-height: 3em;
  position:absolute;
  width:76%;
  left:12%;
  bottom:100px;
  z-index: 9999998;
  text-align: center;
}

#mytext {display:none}
#mystage.text #mytext {
  display:block;
  position: absolute;
  bottom: 20%;
  z-index: 9;
  max-width: 100%;
  width: 320px;
  left: 50%;
  margin-left: -160px;
}
#the-text {
  border: 0;
  background: transparent url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAASFBMVEUAAACZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmampqQkJCZmZmZmZmampqZmZmZmZmZmZmZmZmZmZmbm5uWlpafn5+ZmZm4r8bgAAAAF3RSTlMAiXY++/CGwaVUIwXhcSe2eNrMbRUREAYb5b8AAADFSURBVDjLzdHLDoQgDAVQEMQH+Ha8//+nEwQpsSQsZjN3I+Y0tRbBIuHTxLffXMqKA7LiaP7CZc1Rc0Q3t6/cEXz07AbmqWACtLHMqaBDOwru6Xxp9DQLdzEA6j6osose7vkU1oLbFiY26BTz0HgOEwQWhjzW7yLPQB6y4cjdupeP0GdeYMjTGpcxq9fk6d/Qqmfgvn37pQGEVc/GxVvlM2M5j90/dTfNhGGNIdr36YdPAlpjzCaVFTwK1LgYSY3LWahxMV/1HxkAqaaUXAAAAABJRU5ErkJggg==') no-repeat;
  font-size: 17px;
  width: 100%;
  height: 32px;
  line-height: 32px;
  padding: 0;
  margin: 0;
  text-align: center;
  border-bottom: 1px solid #999;
  outline: none;
}
#mystage.readonly #the-text {
  background-image: none;
  border-bottom: none;
}

body.single #mystyle {
  display: none !important;
}
#taskbar.no-music {
  text-align: center;
}
#taskbar.no-music #mymusic {
  display: none;
}
#taskbar.no-music #mycreate {
  right: 50%;
  -webkit-transform: translateX(50%);
  -moz-transform: translateX(50%);
  -ms-transform: translateX(50%);
  transform: translateX(50%);
}
#mysave, #mystyle {
padding: 4px 8px; color: #000;
background-color: rgba(255,255,255,0.5);
}
#mypreview {
	width: 240px;
	position: fixed;
	margin-left: -120px;
	left: 50%;
	bottom: 64px;
	padding: 1em;
	background: #fff;
	border-radius: 3px;
	border: 6px solid #960;
	text-align: center;
}
#mypreview img {display: block;display:inline-block;margin-right:0}
#mypreview a {color: #960; padding: 4px 9px; border: 1px solid #960;border-radius: 3px;}
</style>
</head>
<body class="LANG_en">
<script>
var lang = navigator.language;
if(/^zh-CN$/i.test(lang)) {lang = "zh-CN";}else if(/^zh/i.test(lang)){lang = "zh-TW";}else{lang = "en";}
if(lang != "en"){document.body.className = 'LANG_' + lang;}
var t={'en':'USTC - 60TH ANNIVERSARY', 'zh-CN':'中国科技大学60周年庆', 'zh-TW':'中國科學技術大學六十週年慶'}; document.title = t[lang]||t['en'];
</script>
<div id="mystage" class="create">
  <div id="mycache" style="display:none"><img id="myface" src="assets/demo.jpg" /><img id="myimg" /></div>
  <div id="myarea" class="gpu" style="background-image:url('assets/demo.jpg')"></div>
  <div id="mymask"></div>
  <div id="mytext" class="nopan dont"><input type="text" id="the-text" /></div>
<div id="taskbar" class="nopan"><div id="mymusic" class="nopan icon"><div class="icons"></div></div><div id="myselect" class="icon"><div class="icons"></div></div><div id="myshare" class="icon"><div class="icons"></div></div><a id="myrel">选图…</a><a id="mysave" class="icon">预览(PREVIEW)</a><div id="mystyle" class="icon">模板</div><div id="mycreate" class="icon"><div class="guide"><en>New</en><zh-CN>新贺卡</zh-CN><zh-TW>新賀卡</zh-TW></div><div class="icons"></div></div></div>
<div id="stylist"></div>
</div>
<div id="mytips">
  <div class="wx">
  <en>Click on the top right <span class="share-way">···</span><br>to share</en>
  <zh-CN>点击右上角<span class="share-way">···</span>，可分享给好友或朋友圈</zh-CN>
  <zh-TW>點擊右上角<span class="share-way">···</span>，即可分享給WeChat好友或朋友圈</zh-TW>
  </div>
  <div class="web">
  <en>Share Link </en>
  <zh-CN>分享网址 </zh-CN>
  <zh-TW>分享網址 </zh-TW>
  <br><input type="text" /><button id="mytry"><en>Visit</en>
  <zh-CN>打开</zh-CN>
  <zh-TW>訪問</zh-TW></button>
  </div>
</div>
<div style="display:none">
<span id="t_SHARE"><en>USTC - 60TH ANNIVERSARY</en><zh-CN>中国科技大学60周年庆</zh-CN><zh-TW>中國科學技術大學六十週年慶</zh-TW></span>
</div>
<div id="mypreview" style="display:none">
<img id="myresult" width="160" /><p>长按保存/PC右键保存</p><a id="myhide">隐藏(HIDE)</a>
</div>

<form id="upform" enctype="multipart/form-data" method="POST" class="nopan">
<input id="mypick" name="file" type="file" />
</form>
<script>// config
//   "text": {default: 'Say something...', style:'text-ny2015'}
var _tpldir = "./templates/";
var cards = {
'USTC-60TH': {
  "width": 640,
  "height": 960,
  "area": {x:0, y:0, w:640, h:960},
  "music": false,//['canon-in-d-piano'],
 },
'60th_x': {
  "width": 886,
  "height": 886,
  "area": {x:0, y:0, w:886, h:886},
  "music": false,//['canon-in-d-piano'],
 },
'60th_y': {
  "width": 886,
  "height": 886,
  "area": {x:0, y:0, w:886, h:886},
  "music": false,//['canon-in-d-piano'],
 }
};
var afm = window.location.search.match(/[\?&]af=([a-z]+)/), af = afm?afm[1]:'';
var cardStyles = [], cardThumbPos = 0;for(var k in cards) {if(!af || (cards[k].af && cards[k].af.indexOf(af)>-1)) cardStyles.push(k);}
if(cardStyles.length==0) {cardStyles.push('holiday')}
var defaultStyle = cardStyles[0];
document.getElementById('myimg').src = _tpldir +defaultStyle+'.png';
document.getElementById('mymask').style.backgroundImage = 'url("' +_tpldir +defaultStyle+'.png")';

var tif = {'en':{'-1': 'e-card save failed, try again?', '-2':'read photo failed', '-3':'share available when e-card is ready', '1': 'e-card ready for sharing', '9':'loading photo...', '99':'saving your e-card for sharing...'},
'zh-CN': {'-1': '贺卡保存失败，请重选照片。', '-2':'照片读取失败', '-3':'贺卡保存完成才可以分享', '1': '贺卡已保存，可以分享啦。', '9':'正在加载照片…', '99':'正在为分享保存贺卡…'},
'zh-TW': {'-1': '賀卡保存失敗，請重選照片。', '-2':'照片讀取失敗', '-3':'賀卡保存完成才可以分享', '1': '賀卡已保存，可以分享啦。', '9':'正在載入照片…', '99':'正在為分享保存賀卡…'}
};
</script>
<script src="assets/zepto.min.js"></script>
<script src="assets/hammer.min.js"></script>
<script>
'use strict';
var B64={alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",lookup:null,ie:/MSIE /.test(navigator.userAgent),ieo:/MSIE [67]/.test(navigator.userAgent),encode:function(s){var buffer=B64.toUtf8(s),position=-1,len=buffer.length,nan0,nan1,nan2,enc=[,,,];if(B64.ie){var result=[];while(++position<len){nan0=buffer[position];nan1=buffer[++position];enc[0]=nan0>>2;enc[1]=(nan0&3)<<4|nan1>>4;if(isNaN(nan1))enc[2]=enc[3]=64;else{nan2=buffer[++position];enc[2]=(nan1&15)<<2|nan2>>6;enc[3]=isNaN(nan2)?64:nan2&63}result.push(B64.alphabet.charAt(enc[0]),B64.alphabet.charAt(enc[1]),B64.alphabet.charAt(enc[2]),B64.alphabet.charAt(enc[3]))}return result.join("")}else{var result="";while(++position<len){nan0=buffer[position];nan1=buffer[++position];enc[0]=nan0>>2;enc[1]=(nan0&3)<<4|nan1>>4;if(isNaN(nan1))enc[2]=enc[3]=64;else{nan2=buffer[++position];enc[2]=(nan1&15)<<2|nan2>>6;enc[3]=isNaN(nan2)?64:nan2&63}result+=B64.alphabet[enc[0]]+B64.alphabet[enc[1]]+B64.alphabet[enc[2]]+B64.alphabet[enc[3]]}return result}},decode:function(s){if(s.length%4)throw new Error("InvalidCharacterError: 'B64.decode' failed: The string to be decoded is not correctly encoded.");var buffer=B64.fromUtf8(s),position=0,len=buffer.length;if(B64.ieo){var result=[];while(position<len){if(buffer[position]<128)result.push(String.fromCharCode(buffer[position++]));else if(buffer[position]>191&&buffer[position]<224)result.push(String.fromCharCode((buffer[position++]&31)<<6|buffer[position++]&63));else result.push(String.fromCharCode((buffer[position++]&15)<<12|(buffer[position++]&63)<<6|buffer[position++]&63))}return result.join("")}else{var result="";while(position<len){if(buffer[position]<128)result+=String.fromCharCode(buffer[position++]);else if(buffer[position]>191&&buffer[position]<224)result+=String.fromCharCode((buffer[position++]&31)<<6|buffer[position++]&63);else result+=String.fromCharCode((buffer[position++]&15)<<12|(buffer[position++]&63)<<6|buffer[position++]&63)}return result}},toUtf8:function(s){var position=-1,len=s.length,chr,buffer=[];if(/^[\x00-\x7f]*$/.test(s))while(++position<len)buffer.push(s.charCodeAt(position));else while(++position<len){chr=s.charCodeAt(position);if(chr<128)buffer.push(chr);else if(chr<2048)buffer.push(chr>>6|192,chr&63|128);else buffer.push(chr>>12|224,chr>>6&63|128,chr&63|128)}return buffer},fromUtf8:function(s){var position=-1,len,buffer=[],enc=[,,,];if(!B64.lookup){len=B64.alphabet.length;B64.lookup={};while(++position<len)B64.lookup[B64.alphabet.charAt(position)]=position;position=-1}len=s.length;while(++position<len){enc[0]=B64.lookup[s.charAt(position)];enc[1]=B64.lookup[s.charAt(++position)];buffer.push(enc[0]<<2|enc[1]>>4);enc[2]=B64.lookup[s.charAt(++position)];if(enc[2]==64)break;buffer.push((enc[1]&15)<<4|enc[2]>>2);enc[3]=B64.lookup[s.charAt(++position)];if(enc[3]==64)break;buffer.push((enc[2]&3)<<6|enc[3])}return buffer}};var Qs=window.location.search,Qp={};if(Qs){var d=Qs.substr(1).split("&");d.forEach(function(v,k,i){i=v.indexOf("=");if(i>0){Qp[v.substr(0,i)]=decodeURIComponent(v.substr(i+1)).replace(/</g,"&#60;").replace(/>/g,"&#62;")}else{Qp[v]=true}})}
var readonly;(function(){function e(e){var a=e.naturalWidth,t=e.naturalHeight;if(a*t>1024*1024){var r=document.createElement("canvas");r.width=r.height=1;var i=r.getContext("2d");i.drawImage(e,-a+1,0);return i.getImageData(0,0,1,1).data[3]===0}else{return false}}function a(e,a,t){var r=document.createElement("canvas");r.width=1;r.height=t;var i=r.getContext("2d");i.drawImage(e,0,0);var s=i.getImageData(0,0,1,t).data;var n=0;var o=t;var d=t;while(d>n){var c=s[(d-1)*4+3];if(c===0){o=d}else{n=d}d=o+n>>1}var l=d/t;return l===0?1:l}function t(e,a,t){var i=document.createElement("canvas");r(e,i,a,t);return i.toDataURL("image/jpeg",a.quality||.8)}function r(t,r,s,n){var o=t.naturalWidth,d=t.naturalHeight;if(!(o+d))return;var c=s.width,l=s.height;var f=r.getContext("2d");f.save();i(r,f,c,l,s.orientation);var h=e(t);if(h){o/=2;d/=2}var u=1024;var m=document.createElement("canvas");m.width=m.height=u;var g=m.getContext("2d");var v=n?a(t,o,d):1;var y=Math.ceil(u*c/o);var p=Math.ceil(u*l/d/v);var w=0;var C=0;while(w<d){var $=0;var b=0;while($<o){g.clearRect(0,0,u,u);g.drawImage(t,-$,-w);f.drawImage(m,0,0,u,u,b,C,y,p);$+=u;b+=y}w+=u;C+=p}f.restore();m=g=null}function i(e,a,t,r,i){switch(i){case 5:case 6:case 7:case 8:e.width=r;e.height=t;break;default:e.width=t;e.height=r}switch(i){case 2:a.translate(t,0);a.scale(-1,1);break;case 3:a.translate(t,r);a.rotate(Math.PI);break;case 4:a.translate(0,r);a.scale(1,-1);break;case 5:a.rotate(.5*Math.PI);a.scale(1,-1);break;case 6:a.rotate(.5*Math.PI);a.translate(0,-r);break;case 7:a.rotate(.5*Math.PI);a.translate(t,-r);a.scale(-1,1);break;case 8:a.rotate(-.5*Math.PI);a.translate(-t,0);break;default:break}}var s=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;function n(e){if(window.Blob&&e instanceof Blob){if(!s){throw Error("No createObjectURL function found to create blob url")}var a=new Image;a.src=s.createObjectURL(e);this.blob=e;e=a}if(!e.naturalWidth&&!e.naturalHeight){var t=this;e.onload=e.onerror=function(){var e=t.imageLoadListeners;if(e){t.imageLoadListeners=null;for(var a=0,r=e.length;a<r;a++){e[a]()}}};this.imageLoadListeners=[]}this.srcImage=e}n.prototype.render=function(e,a,i){if(this.imageLoadListeners){var n=this;this.imageLoadListeners.push(function(){n.render(e,a,i)});return}a=a||{};var o=this.srcImage.naturalWidth,d=this.srcImage.naturalHeight,c=a.width,l=a.height,f=a.maxWidth,h=a.maxHeight,u=!this.blob||this.blob.type==="image/jpeg";if(c&&!l){l=d*c/o<<0}else if(l&&!c){c=o*l/d<<0}else{c=o;l=d}if(f&&c>f){c=f;l=d*c/o<<0}if(h&&l>h){l=h;c=o*l/d<<0}var m={width:c,height:l};for(var g in a)m[g]=a[g];var v=e.tagName.toLowerCase();if(v==="img"){e.src=t(this.srcImage,m,u)}else if(v==="canvas"){r(this.srcImage,e,m,u)}if(typeof this.onrender==="function"){this.onrender(e)}if(i){i()}if(this.blob){this.blob=null;s.revokeObjectURL(this.srcImage.src)}};if(typeof define==="function"&&define.amd){define([],function(){return n})}else{window.MegaPixImage=n}})();if(!window._CLICK){window._CLICK="ontouchstart"in window?"tap":"click"}var reqAnimationFrame=function(){return window[Hammer.prefixed(window,"requestAnimationFrame")]||function(e){window.setTimeout(e,1e3/60)}}();var ds=[0,0,1,0,0,0,1],readonly=false;var toastTid,toastOb;function toast(e,a){if(toastTid)clearTimeout(toastTid);if(typeof e=="number")e=tif[lang][""+e]||"";var t=$("#mytoast");if(!e){t.hide();t=null;return}if(t.length==0){$(document.body).append('<div id="mytoast"><div>');t=$("#mytoast");t.click(function(){$(this).hide()})}t.html(e).show();t=null;if(!a)toastTid=setTimeout(function(){$("#mytoast").hide()},5e3)}(function(){var e=$("#myarea").get(0);var a=0,t=0;var r=0,i=0;var s=false;var n;var o=new Hammer.Manager(document.body);o.add(new Hammer.Pan({threshold:0,pointers:0}));o.add(new Hammer.Swipe).recognizeWith(o.get("pan"));o.add(new Hammer.Rotate({threshold:0})).recognizeWith(o.get("pan"));o.add(new Hammer.Pinch({threshold:0})).recognizeWith([o.get("pan"),o.get("rotate")]);o.on("panstart panmove",f);o.on("rotatestart rotatemove",g);o.on("pinchstart pinchmove",u);function d(e){if(!e)e=[0,0,1,0,0,0,1];t=0;i=0;n={translate:{x:a+e[0],y:r+e[1]},scale:e[2],angle:e[3],rx:e[4],ry:e[5],rz:e[6]};l()}function c(){var a=["translate3d("+n.translate.x+"px, "+n.translate.y+"px, 0)","scale("+n.scale+", "+n.scale+")","rotate3d("+n.rx+","+n.ry+","+n.rz+","+n.angle+"deg)"];ds=[n.translate.x,n.translate.y,n.scale,n.angle,n.rx,n.ry,n.rz];a=a.join(" ");e.style.webkitTransform=a;e.style.mozTransform=a;e.style.transform=a;s=false}function l(){if(!s){reqAnimationFrame(c);s=true}}function f(e){if(readonly||$(e.target).hasClass("nopan")||$(e.target).parent().hasClass("nopan"))return true;if(e.type=="panstart"){a+=t;r+=i;t=0;i=0;n.translate={x:a,y:r}}else{t=e.deltaX;i=e.deltaY;n.translate={x:a+e.deltaX,y:r+e.deltaY}}l()}var h=1;function u(a){if(readonly)return true;if(a.type=="pinchstart"){h=n.scale||1}e.className="";n.scale=h*a.scale;l()}var m=0;function g(a){if(readonly)return true;if(a.type=="rotatestart"){m=n.angle||0}e.className="";n.rz=1;n.angle=m+a.rotation;l()}window.resetEl=d})();var upSrc="";function getMyOpts(e,a){var t=ds[0],r=ds[1];t+=refer.left+refer.offset.x;r+=refer.top+refer.offset.y;var i=Math.max(e/refer.width,a/refer.height);var s={x:refer.width-e/i,y:refer.height-a/i};t+=s.x/2;r+=s.y/2;var n=1;var o=ds[3];var d=(refer.width-s.x)/refer.ratio,c=(refer.height-s.y)/refer.ratio;var l={x:t/refer.ratio-(ds[2]*d-d)/2,y:r/refer.ratio-(ds[2]*c-c)/2,scale:n,angle:o,w:ds[2]*d,h:ds[2]*c};return l}var A2RAD=Math.PI/180;function drawMe(e,a,t){var r=t.x||0,i=t.y||0;var s=t.scale||1,n=(t.angle||0)*A2RAD;e.save();var o=t.w,d=t.h;var c=o/2,l=d/2;var f=r,h=i;if(n!=0){e.translate(c,l);e.rotate(n);e.translate(-c,-l);f=r*Math.cos(n)+i*Math.sin(n);h=-r*Math.sin(n)+i*Math.cos(n)}if(false&&s!=1){e.scale(s,s);f+=(o*s-o)/2;h+=(d*s-d)/2}e.drawImage(a,f,h,o,d);e.restore()}var aCanvas,aCTX;function saveWork(){
	var e=card.width,a=card.height;
	if(!aCTX){aCanvas=document.createElement("canvas");aCanvas.style.display="none";
	document.body.appendChild(aCanvas);$(aCanvas).attr({width:e,height:a});aCTX=aCanvas.getContext("2d")}else{$(aCanvas).attr({width:e,height:a});aCTX=aCanvas.getContext("2d")}aCTX.fillStyle="#FFFFFF";aCTX.fillRect(0,0,e,a);
	var t=$("#myface").get(0);var r=getMyOpts(t.width,t.height);drawMe(aCTX,t,r);aCTX.drawImage($("#myimg").get(0),0,0,e,a);
	//this.href=aCanvas.toDataURL();
	$('#myresult').get(0).src = aCanvas.toDataURL();
	$('#mypreview').show();
	$('#mystage').css('opacity', .5);
	readonly = true;
}false&&$("#upform").on("submit",function(e){e.preventDefault();var a=new FormData(this);upload(a)});function upload(e,a,t){return;toast(99,!0);$.ajax({type:"POST",url:t?t:$("#upform").attr("action"),data:e,dataType:"text",contentType:a?a:$("#upform").attr("enctype"),processData:false,success:function(e){var a;if(typeof e=="string"){try{a=JSON.parse(e.replace(/^\s+|\s+$/g,"").replace(/\}[^a-z]*$/,"}"))}catch(t){}}else{a=e}if(a&&a.url){upSrc=a.url;toast(1)}else{toast(-1,!0)}},error:function(e,a,t){toast(-1,!0)}})}function dropChangeHandler(e){false&&toast(9,!0);e.preventDefault();var a=e.dataTransfer||e.target,t=a&&a.files&&a.files[0],r={maxWidth:8192,canvas:true};if(!t){return}var i=new MegaPixImage(t);var s=$("#myface").get(0);i.render(s,{maxWidth:($("#myarea").width()<card.width/2?4:1)*$("#myarea").width(),maxHeight:($("#myarea").width()<card.width/2?4:1)*$("#myarea").height(),quality:.85},function(){$("#myarea").css("background-image","url("+s.src+")");var e=";base64,",a=s.src.indexOf(e);var t=s.src.substr(0,a).match(/image\/([a-z]+)/);a+=e.length;setTimeout(function(){upload((t?t[1].replace(/jpeg/i,"jpg"):"jpg")+";"+s.src.substr(a),"application/x-www-form-urlencoded");i=s=null})})}$("#mypick").on("change",dropChangeHandler);var ubase=location.href,ubase2=location.href;var cardStyle=Qp.i||"";var card;var shareConf;var refer={};function adjArea(){if(!card)return false;var e={w:$("#mystage").width(),h:$("#mystage").height()};var a=Math.max(e.w/card.width,e.h/card.height);var t={x:(card.width*a-e.w)/2,y:(card.height*a-e.h)/2};var r=card.area;refer={left:r.x*a-t.x,top:r.y*a-t.y,width:r.w*a,height:r.h*a};$("#myarea").css(refer);refer.stage=e;refer.ratio=a;refer.offset=t;adjFile()}function adjFile(){if($("#myselect").length==0)return;var e=$("#myselect").offset();if(e)$("#upform").css({left:e.left,top:e.top,width:$("#myselect").width(),height:$("#myselect").height()})}function setMoji(e){$("#myface").attr("src",e);$("#myarea").css("background-image",'url("'+e+'")')}var DEFAULT_TITLE=document.title;var SHARE_TITLE=$("#t_SHARE "+lang).text();var SHARE_TITLE2=SHARE_TITLE;var SharePack={appid:"",img_url:_tpldir+cardStyle+"-thumb.jpg",img_width:"120",img_height:"120",link:window.location.href,desc:SHARE_TITLE,title:DEFAULT_TITLE};$('meta[name="description"], meta[property="og:description"]').attr("content",SHARE_TITLE);function styCard(e){if(!cards[e])return false;var a=_tpldir+e+".png";$("#myimg").attr("src",a);$("#mymask").css("background-image",'url("'+a+'")');if(card)card.last=ds;card=cards[e];$("#mysave").attr("download","ME-"+e+"_by_MINDON_AT_GMAIL_COM.png");if(card.text){$("#mystage").addClass("text");var t=card.text.style||"";$("#mytext").attr("class",t?"nopan dont "+t:"nopan dont");$("#the-text").val(card.text.default||"")}else if($("#mystage").hasClass("text")){$("#the-text").val("");$("#mystage").removeClass("text")}if(card.last){ds=card.last}else{if(shareConf&&shareConf.d&&shareConf.i==e&&(!shareConf.u||$("#myface").attr("src").indexOf(shareConf.u)>-1)){ds=shareConf.d.concat(0,0,1)}else{ds=[0,0,1,0,0,0,1];if(card.area.deg){ds[3]=card.area.deg}}}cardStyle=e;SharePack.img_url=window.location.href.replace(/[^\/]*[\?#].*$/,"")+_tpldir+cardStyle+"-thumb.jpg";adjArea();resetEl(ds);if(card.music==false){$("#taskbar").addClass("no-music")}else if($("#taskbar").hasClass("no-music")){$("#taskbar").removeClass("no-music")}}var stylisted=false,skipIds=["mystyle","mycreate","listprev","listnext","stylist","listct"];function stylize(e){if($(this).hasClass("active")){return}$("#stylist:visible").animate({height:0},"fast");var a=$(this).parent().find("img.active");if(a.length>0){a.removeClass("active")}$(this).parent().find("img.active").removeClass("active");var t=$(this).addClass("active").attr("src").match(/([^\/]+)-thumb\.jpg$/);if(t){styCard(t[1]);if(a.length===0)$("#mypick").click();window.ga&&ga("send","event","button","click","E-Card Style = "+cardStyle)}}function stypage(e){$("#listct img").unbind(_CLICK);if(e==-1&&cardThumbPos>0){cardThumbPos-=4;if(cardThumbPos<0)cardThumbPos=0}else if(e==1&&cardThumbPos<cardStyles.length-1){cardThumbPos+=4}else if(e!=0){return}if(cardThumbPos==0){if(!$("#listprev").hasClass("none"))$("#listprev").addClass("none")}else if($("#listprev").hasClass("none")){$("#listprev").removeClass("none")}if(cardThumbPos+4>=cardStyles.length){if(!$("#listnext").hasClass("none"))$("#listnext").addClass("none")}else if($("#listnext").hasClass("none")){$("#listnext").removeClass("none")}var a="",t=cardStyles.slice(cardThumbPos,cardThumbPos+4);for(var r=0;r<t.length;r++){var i=t[r];a+='<img src="'+_tpldir+i+'-thumb.jpg" class="'+(cards[i].be?cards[i].be:"")+(i==cardStyle?" active":"")+'" />'}$("#listct").html(a).find("img").on(_CLICK,stylize)}function styup(){$('#myhide').click();if(!stylisted){stylisted=true;setMoji("assets/demo.jpg");$("#stylist").html('<div id="thumblist" class="nopan"><div id="listprev" class="none"></div><div id="listct" class="nopan"></div><div id="listnext"></div></div>');stypage(0);$("#listprev").on(_CLICK,function(){if(!$(this).hasClass("none"))stypage(-1)});$("#listnext").on(_CLICK,function(){if(!$(this).hasClass("none"))stypage(1)});$("#myselect").on(_CLICK,function(){$("#mypick").click()});$("#mysave").on(_CLICK,saveWork);setTimeout(adjFile,50)}if(!$(document.body).hasClass("single")){$("#stylist").show().animate({height:95},"fast")}}$(function(){if(Qp.be&&/^[\w-\.]+$/.test(Qp.be)){$("#stylist").addClass(Qp.be)}if(Qp.d){shareConf=JSON.parse(B64.decode(Qp.d));var e=shareConf;if(e){var a=e.d;if(e.u){upSrc=e.u;if(upSrc.charAt(0)=="@"){upSrc=ubase+upSrc.substr(1)}else if(upSrc.charAt(0)==">"){upSrc=ubase2+upSrc.substr(1)}setMoji(upSrc);readonly=true}if(e.i){styCard(e.i)}if(e.t){$("#the-text").val(e.t)}}}else{styCard(cardStyle||defaultStyle)}adjArea();if(shareConf&&shareConf.d){shareConf.d[0]*=refer.ratio;shareConf.d[1]*=refer.ratio;ds=shareConf.d.concat(0,0,1);resetEl(ds)}else{if(card.area.deg){ds[3]=card.area.deg}resetEl(ds)}var t=ds.slice(0);$(window).resize(adjArea);$(document.body).on("dblclick",function(e){var a=e.target;if(readonly||a&&($(a).hasClass("nopan")||$(a).parent().hasClass("nopan")))return;t[3]=card.area.deg||0;resetEl(t)}).on(_CLICK,function(e){if(readonly)return;var a=e.target;if(a&&skipIds.indexOf(a.id)==-1&&a.parentNode!=document.getElementById("stylist")){$("#stylist:visible").animate({height:0},"fast")}});$("#myarea").on(_CLICK,function(){if(readonly||$(this).css("background-image").indexOf("assets/demo.jpg")===-1)return;$("#mypick").click()});styup();$("#mystyle").on(_CLICK,function(){setTimeout(function(){styup()},10)})});function shareV(e){var a=ds.slice(0,4);a[0]=a[0]/refer.ratio;a[1]=a[1]/refer.ratio;if(!e)e=upSrc;if(e.indexOf(ubase)===0){e="@"+e.substr(ubase.length)}else if(e.indexOf(ubase2)===0){e=">"+e.substr(ubase2.length)}var t={i:cardStyle,u:e||"assets/demo.jpg",d:a};if($("#mystage").hasClass("text"))t.t=$("#the-text").val();return B64.encode(JSON.stringify(t))}if(SharePack.img_url.indexOf("://")<0){SharePack.img_url=window.location.href.replace(/[^\/]*[\?#].*$/,"")+SharePack.img_url}function shareCb(e){}function shareLink(e){if(!e){e=SharePack.link}if(e){e=e.replace(/([&\?])(af|d)=[^&#]+/,"");e+=(e.indexOf("?")>0?"&":"?")+(window.af?"af="+window.af+"&":"")+"d="+shareV();return e}else{return window.location.href}}function wxTask(e,a){var t=window.ga;if(!upSrc){alert(tif[lang]["-3"]);t&&t("send","event","button","click","E-Card Share Failed - "+cardStyle);return false}if(!a)a=SharePack;var r=a.url||a.link;r=shareLink(r);if(a.url){a.url=r}else{a.link=r}WeixinJSBridge.invoke(e,a,shareCb);t&&t("send","event","button","click","E-Card Share - "+cardStyle+": "+e)}function onWxReady(){document.getElementsByTagName("html")[0].className="wechat";WeixinJSBridge.on("menu:share:appmessage",function(e){wxTask("sendAppMessage")});WeixinJSBridge.on("menu:share:timeline",function(e){wxTask("shareTimeline")});WeixinJSBridge.on("menu:share:weibo",function(e){wxTask("shareWeibo",{content:SharePack.title,url:SharePack.link})});WeixinJSBridge.on("menu:share:facebook",function(e){wxTask("shareFB")})}if(document.addEventListener){document.addEventListener("WeixinJSBridgeReady",onWxReady,false)}else if(document.attachEvent){document.attachEvent("WeixinJSBridgeReady",onWxReady);document.attachEvent("onWeixinJSBridgeReady",onWxReady)}$(function(){$("#myshare").on(_CLICK,function(){readonly=true;window.touchEmulatorOff=true;$("#mytips").show().find("input").val(shareLink()).focus()});$("#mycreate").on(_CLICK,function(e){e.stopPropagation();$("#mystage").removeClass("readonly");if(card.text&&card.text.default){$("#the-text").val(card.text.default)}readonly=false;setTimeout(function(){styup();$("#mystage").removeClass("create")},10)});$("#mytips").on(_CLICK,function(e){if(e.target.tagName=="INPUT")return true;$(this).hide();readonly=false;window.touchEmulatorOff=false});$("#mytips .web input").focus(function(){this.select()});$("#mytry").on(_CLICK,function(){window.open($("#mytips .web input").val())})});
</script>
<div style="font-size:1px;width:1px;height:1px;position:absolute;bottom:-1px;right:-1px;"><audio loop id="myaudio"></audio></div>
<script>
if(cardStyles.length==1) $(document.body).addClass('single');
var al=false, asrc = 'deck-the-halls,jingle-bells,silent-night,we-wish-you-a-merry-christmas'.split(',')[Math.floor(4*Math.random())%4];
$('#mymusic').addClass('silence').on(_CLICK, function(e){
  e.stopPropagation();
  if($(this).hasClass('silence')) {
    if(!al) {
      var src = asrc;
      if(card.music) {
        if(typeof card.music == 'string') {
          src = card.music;
        } else {
          var zc = card.music.length;
          src = card.music[zc==1?0:Math.round(zc*Math.random())%zc];
        }
      }
      $('#myaudio').append('<source src="music/'+src+'.ogg" type="audio/ogg"><source src="music/'+src+'.mp3" type="audio/mpeg">');
      al=true;
    }
    $('#myaudio').get(0).volume = 0.5;
    $('#myaudio').get(0).play();
    $(this).removeClass('silence');
  } else {
    $('#myaudio').get(0).pause();
    $(this).addClass('silence');
  }
});
$('#myhide').on(_CLICK,function(){
	readonly = false;
	$('#mystage').css('opacity', 1);
	$('#mypreview').hide();
});
$('#myrel').on(_CLICK,function(){
	$('#myhide').click();
	$('#mypick').click();
});
</script>
</body>
</html>
